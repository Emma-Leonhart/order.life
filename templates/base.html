<!DOCTYPE html>
<html lang="{{ lang }}"{% if rtl %} dir="rtl"{% endif %}>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %}{{ t.site_title }}{% endblock %} — {{ t.religion_kanji }}</title>
  <meta name="description" content="{% block meta_description %}{{ t.tagline }}{% endblock %}">
  <meta property="og:site_name" content="{{ t.site_title }}">
  <meta property="og:type" content="{% block og_type %}website{% endblock %}">
  <meta property="og:title" content="{% block og_title %}{{ t.site_title }} — {{ t.religion_name }}{% endblock %}">
  <meta property="og:description" content="{% block og_description %}{{ t.tagline }}{% endblock %}">
  <meta property="og:url" content="https://order.life{{ base }}{% if path_suffix %}{{ path_suffix }}{% else %}/{% endif %}">
  <meta property="og:image" content="https://order.life/static/mei.svg">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="{% block twitter_title %}{{ t.site_title }} — {{ t.religion_name }}{% endblock %}">
  <meta name="twitter:description" content="{% block twitter_description %}{{ t.tagline }}{% endblock %}">
  <meta name="twitter:image" content="https://order.life/static/mei.svg">
  <link rel="icon" href="/static/favicon.svg" type="image/svg+xml">
  <link rel="stylesheet" href="/static/css/style.css">
  <script src="/static/js/gaian-calendar.js" defer></script>
  <script>
    // Redirect language subdomains: ja.order.life/* → order.life/ja/*
    (function() {
      var m = location.hostname.match(/^([a-z]{2})\.order\.life$/);
      if (m) location.replace('https://order.life/' + m[1] + '/' + location.pathname.replace(/^\//, '') + location.search + location.hash);
    })();
  </script>
  {% block head %}{% endblock %}
</head>
<body>
  <nav>
    <div class="nav-inner">
      <a class="nav-brand" href="{{ base }}/">{% if not is_cjk %}<span class="brand-kanji">命</span> {% endif %}{{ t.site_title }}</a>
      <button class="nav-toggle" onclick="document.querySelector('.nav-links').classList.toggle('open')">☰</button>
      <div class="nav-links">
        <a href="{{ base }}/calendar/">{{ t.nav.calendar }}</a>
        <a href="{{ base }}/gaiad/">{{ t.nav.scripture }}</a>
        <a href="{{ base }}/mythology/">{{ t.nav.mythology }}</a>
        <a href="{{ base }}/philosophy/">{{ t.nav.philosophy }}</a>
        <a href="{{ base }}/shrines/">{{ t.nav.shrines }}</a>
        <a href="{{ base }}/longevity/">{{ t.nav.longevity }}</a>
        <a href="{{ base }}/evolution/">{{ t.nav.evolution }}</a>
        <a href="{{ base }}/fudoki/">Realms</a>
        <a href="{{ base }}/map/">Map</a>
        <a href="{% if path_suffix and not path_suffix.startswith('/calendar/') %}https://wiki.order.life{{ path_suffix }}{% else %}https://wiki.order.life/Main_Page/{% endif %}">{{ t.nav.wiki }}</a>
      </div>
      <div class="nav-right">
        <a class="discord-link" href="https://discord.gg/nSD5hZCu2u" target="_blank" rel="noopener" aria-label="Discord">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057c.002.022.015.043.03.054a19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028 14.09 14.09 0 0 0 1.226-1.994.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128 10.2 10.2 0 0 0 .372-.292.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03z"/></svg>
          Discord
        </a>
        <div class="lang-switcher">
          {% set lang_labels = {'en': 'English', 'ja': '日本語', 'zh': '中文', 'es': 'Español', 'hi': 'हिन्दी', 'ar': 'العربية', 'fr': 'Français', 'ru': 'Русский', 'uk': 'Українська'} %}
          <select onchange="location.href=this.value" aria-label="Language">
            {% for l in languages %}
            <option value="{{ lang_bases[l] }}{{ path_suffix }}"{% if l == lang %} selected{% endif %}>{{ lang_labels.get(l, l) }}</option>
            {% endfor %}
          </select>
        </div>
      </div>
    </div>
  </nav>

  {% block content %}{% endblock %}

  <div class="wiki-cta">
    <div class="wiki-cta-inner">
      <div class="wiki-cta-text">
        <div class="wiki-cta-title">{{ t.nav.wiki }}</div>
        <div class="wiki-cta-subtitle">Help improve this page on the wiki.</div>
      </div>
      <a id="wikiCtaLink" class="wiki-cta-btn"
         href="{% if path_suffix and not path_suffix.startswith('/calendar/') %}https://wiki.order.life{{ path_suffix }}{% else %}https://wiki.order.life/Main_Page/{% endif %}">Go to the wiki page</a>
    </div>
  </div>

  <footer>
    <p>{{ t.religion_kanji }} · {{ t.religion_name }} · {{ t.site_title }}</p>
    <p><a href="{% if path_suffix and not path_suffix.startswith('/calendar/') %}https://wiki.order.life{{ path_suffix }}{% else %}https://wiki.order.life/Main_Page/{% endif %}">{{ t.nav.wiki }}</a></p>
  </footer>

  {% block scripts %}{% endblock %}
  <script>
    // Set up localized names for JS date display
    window.LANG_BASE = {{ base | tojson }};
    window.GAIAN_MONTH_NAMES = {{ t.months | tojson }};
    window.GAIAN_WEEKDAY_NAMES = {{ preferred_weekday_names | tojson }};
    // Wiki month names (match Miraheze titles)
    window.GAIAN_WIKI_MONTH = {
      sagittarius: 'Sagittarius',
      capricorn: 'Capricorn',
      aquarius: 'Aquarius',
      pisces: 'Pisces',
      aries: 'Aries',
      taurus: 'Taurus',
      gemini: 'Gemini',
      cancer: 'Cancer',
      leo: 'Leo',
      virgo: 'Virgo',
      libra: 'Libra',
      scorpius: 'Scorpio',
      ophiuchus: 'Ophiuchus',
      horus: 'Horus'
    };
  </script>

  <script>
function computeLocalWikiTitle(pathname, langBase) {
  // Strip the language base prefix (e.g. '/ja') from the pathname
  var strip = pathname;
  if (langBase) strip = pathname.replace(new RegExp('^' + langBase.replace('/', '\\/') + '(/|$)'), '/');
  const path = strip.replace(/\/+$/, '/');

  if (path === '/' || path === '/index.html') return 'Main_Page';

  // Calendar
  if (path === '/calendar/' ) return 'Gaian_calendar';
  if (path === '/calendar/gaian-era/' ) return 'Gaian_Era';
  if (path === '/calendar/datepicker/' ) return 'Gaian_calendar_datepicker';

  const calDay = path.match(/^\/calendar\/([a-z-]+)\/(\d{2})\/$/);
  if (calDay) {
    const monthId = calDay[1];
    const day = parseInt(calDay[2], 10);
    const monthWiki = (window.GAIAN_WIKI_MONTH && window.GAIAN_WIKI_MONTH[monthId]) || monthId;
    return `${monthWiki}_${day}`;
  }
  const calMonth = path.match(/^\/calendar\/([a-z-]+)\/$/);
  if (calMonth) {
    const monthId = calMonth[1];
    const monthWiki = (window.GAIAN_WIKI_MONTH && window.GAIAN_WIKI_MONTH[monthId]) || monthId;
    return `${monthWiki}`;
  }

  // Week pages (aliases)
  if (path === '/week/') return 'week';
  const weekNum = path.match(/^\/week\/(\d)\/$/);
  if (weekNum) {
    const n = parseInt(weekNum[1], 10);
    return `week/${n}`;
  }

  // Scripture index/chapter
  if (path === '/gaiad/') return 'Gaiad';
  const ch = path.match(/^\/gaiad\/(\d{3})\/$/);
  if (ch) return `Gaiad_${ch[1]}`;

  // Sections
  const sec = path.match(/^\/(evolution|longevity|shrines|philosophy|mythology|scripture)\/$/);
  if (sec) return sec[1];

  return 'Main_Page';
}

function updateWikiCta() {
  try {
    const el = document.getElementById('wikiCtaLink');
    if (!el) return;
    const langBase = window.LANG_BASE || '';
    const title = computeLocalWikiTitle(window.location.pathname, langBase);
    el.href = `https://wiki.order.life/${title}/`;
  } catch (e) {
    // best-effort; keep the server-rendered href
    console && console.warn && console.warn('wiki cta update failed', e);
  }
}

document.addEventListener('DOMContentLoaded', updateWikiCta);
  </script>
</body>
</html>
